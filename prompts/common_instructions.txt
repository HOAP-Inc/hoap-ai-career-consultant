purpose
全ての LLM 呼び出しに共通して適用する最上位の制約と出力ルール。各 STEP の system prompt の先頭に挿入して使うこと。

expected_input
- 特に定義なし。各 STEP の system/user が期待する入力スキーマを優先する。
- LLM は呼び出し時にサーバーから渡された JSON ペイロード（例: available_* マップ、stage、user_text 等）を必ず参照して判断すること。

output_schema（注意）
- このファイル自体は固有スキーマを定義しない。各 STEP の system prompt が厳密な出力スキーマを定義すること。
- 以下の出力ルールはすべての呼び出しで強制される。

model
- モデル依存の要件は各 STEP で指定すること（例: STEP1→gpt-4o-mini、STEP2〜5→gpt-4o、STEP6→gpt-5）。

generation_rules（必須制約）
1. 出力は必ず JSON のみとする。プレーンテキストの前置きや注釈を含めない。人間向け補助説明が必要な場合は必ず explain フィールドに入れる。
2. 未定義 ID や辞書外 ID の創出を禁止する。辞書にない表現は unmatched_title 等の文字列フィールドで返すこと（数値 ID を勝手に作成してはならない）。
3. 参照データ（available_* マップ）を尊重すること。出力の ID/ラベルは与えられたマップに基づき決定すること。
4. 信頼度は 0.0〜1.0 で返すこと（小数点 2 桁程度を想定）。意味がない推定は 0.0 を返す。
5. スキーマ不整合や辞書外 ID を検出した場合、必ず次の最小 JSON を返すこと:
   { "_error": "schema_mismatch" | "untrusted_id" | "other", "_raw": "<LLM が生成した生テキスト（必要最小限）>" }
6. 日本語出力を基本とする（入力が日本語であることを前提）。多言語入力の可能性がある場合でも日本語で回答する旨を明記すること。
7. ハルシネーション禁止。事実でない断定、外部データに基づく数値、辞書にない ID の生成を禁ずる。
8. 出力長・語彙制限は各 STEP で指定すること。共通ルールとして誇張語・評価語（例: 「すごい」等）の使用は制限する。
9. デバッグ用生出力は _raw に格納し、判定フィールドに混入させない。
10. このファイルの要件を各 system prompt に必ず参照させること。system prompt と衝突する場合は common_instructions が優先される。

forbidden_actions（厳禁）
- 辞書にない ID を生成すること。
- JSON 以外の文頭説明を出力すること。
- ユーザーを外部行動（転職・応募・サインアップ等）へ誘導する出力。
- 内部設計（サーバー実装）について LLM が提案すること。
- 出力にコードブロックやマークダウン等のフォーマットを含めること。

error_handling
- LLM の出力が JSON としてパースできない場合、サーバーは "_error": "schema_mismatch" と扱う想定。
- LLM には任意フィールド（例: "_note"）を許容するが、必須フィールド以外の混在を避けるよう指示すること。

examples（呼び出し側の messages 配列例）
1) system: (このファイルの内容)
2) system: (STEP 固有の system prompt — 出力 schema をここで定義)
3) user: (STEP 固有の user payload JSON の文字列化)

operational_notes
- サーバーは common_instructions を必ず最初の system メッセージとして渡すこと。STEP の system prompt を続けて渡すこと。両者が衝突した場合は common_instructions を優先する。
- ルールベース判定（polarity_rulebook）をサーバーで実行し、閾値未満のみ LLM を呼ぶ方針を厳守すること。
- このファイルを修正する場合は変更箇所を明確にコメントし、既存の system prompt 全てに影響が及ぶ点をレビュープロセスで承認すること。
