<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>HOAP AI ã‚­ãƒ£ãƒªã‚¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆç•ªå·å¿…é ˆãƒ»Step1ã¯æ·±æ˜ã‚Š/å€™è£œã®ã¿ï¼‰</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .gradient-bg{background:linear-gradient(135deg,#fdf2f8 0%,#faf5ff 50%,#eff6ff 100%)}
  .gradient-text{background:linear-gradient(135deg,#ec4899 0%,#8b5cf6 50%,#3b82f6 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
  .message-enter{animation:slideIn .22s ease-out}
  @keyframes slideIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
  .btn{cursor:pointer;transition:transform .06s ease}
  .btn:active{transform:scale(.98)}
  .chip{display:inline-flex;align-items:center;border:1px solid rgba(236,72,153,.25);background:#fff;border-radius:9999px;padding:.3rem .65rem;margin:.2rem .3rem .2rem 0}
  .chip-ghost{border:1px dashed rgba(99,102,241,.5);background:rgba(255,255,255,.6)}
  .chips{margin-top:.5rem}
</style>
</head>
<body class="gradient-bg min-h-screen text-slate-800">
  <!-- Header -->
  <div class="bg-white/90 backdrop-blur-sm border-b border-pink-100 sticky top-0 z-10 shadow-sm">
    <div class="max-w-4xl mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-bold gradient-text">HOAP AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</h1>
          <p class="text-slate-600 text-sm">ä¸€æ¬¡ãƒ’ã‚¢ãƒªãƒ³ã‚°ï¼ˆç•ªå·å¿…é ˆãƒ»ã‚¿ã‚°å³å¯†æ•´åˆï¼‰</p>
        </div>
        <div class="text-right">
          <div class="text-sm text-slate-500">Step <span id="current-step">1</span>/6</div>
          <div class="text-xs gradient-text font-medium">
            <span id="step-label">åŸºæœ¬æƒ…å ±</span>
            <span id="number-required" class="block text-red-400 text-xs mt-1">â€»æ±‚è·è€…ç•ªå·å¿…é ˆ</span>
          </div>
        </div>
      </div>
      <div class="mt-3 bg-gradient-to-r from-pink-100 to-blue-100 rounded-full h-1">
        <div id="progress-bar" class="bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 h-1 rounded-full transition-all duration-500" style="width:16.67%"></div>
      </div>
      <div class="mt-4 text-sm">
        <div class="text-slate-500">ç¢ºå®šçŠ¶æ³ï¼ˆå†…éƒ¨è¦ç´„ï¼‰</div>
        <div class="chips">
          <span id="chip-id"   class="chip chip-ghost">ç•ªå·ï¼šæœªå…¥åŠ›</span>
          <span id="chip-qual" class="chip chip-ghost">è·ç¨®ï¼šæœªå…¥åŠ›</span>
          <span id="chip-work" class="chip chip-ghost">å‹¤å‹™å…ˆï¼šæœªå…¥åŠ›</span>
          <span id="chip-reason" class="chip chip-ghost">è»¢è·ç†ç”±ï¼šæœªè¨­å®š</span>
          <span id="chip-must"   class="chip chip-ghost">Mustï¼š0ä»¶</span>
          <span id="chip-want"   class="chip chip-ghost">Wantï¼š0ä»¶</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat -->
  <div class="max-w-4xl mx-auto px-6 py-8 pb-32">
    <div id="messages" class="space-y-6">
      <div class="flex justify-start">
        <div class="flex max-w-xs lg:max-w-2xl items-start gap-3">
          <div class="flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-r from-gray-100 to-gray-200 shadow-md border-2 border-white flex items-center justify-center">ğŸ¤–</div>
          <div class="bg-white/90 backdrop-blur-sm text-slate-700 border border-pink-100/50 rounded-2xl px-4 py-3 shadow-sm">
            <div class="text-sm whitespace-pre-wrap leading-relaxed">
              ã“ã‚“ã«ã¡ã¯ï¼<br>
              æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®é¢è«‡ãŒã‚¹ãƒ ãƒ¼ã‚ºã«é€²ã‚€ã‚ˆã†ã«ã€å°‘ã—ã ã‘è©±ã—ã¦ã­ã€‚<br><br>
              ã¾ãš3ã¤æ•™ãˆã¦ï¼<br>
              â‘ æ±‚è·è€…ç•ªå· â‘¡ä»Šã®è·ç¨® â‘¢ä»Šã©ã“ã§åƒã„ã¦ã‚‹ï¼Ÿ<br>
              â€»ä¸€åº¦ã«æ›¸ã„ã¦OKï¼ˆä¾‹ï¼š<span class="text-slate-500">12345 çœ‹è­·å¸« ç·åˆç—…é™¢</span>ï¼‰
            </div>
          </div>
        </div>
      </div>

      <!-- å€™è£œãƒœãƒƒã‚¯ã‚¹ -->
      <div id="option-box" class="hidden">
        <div class="mt-2 rounded-2xl border border-pink-200 bg-white/90 px-4 py-3 shadow-sm">
          <div class="text-xs text-slate-500 mb-2" id="option-hint">ã“ã®ã‚ãŸã‚ŠãŒè¿‘ãã†ã€‚é¸ã‚“ã§ã‚‚ã„ã„ã—ã€ãã®ã¾ã¾ç¶šã‘ã¦ã‚‚OKã ã‚ˆã€‚</div>
          <div id="option-buttons" class="flex flex-wrap gap-2"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Input -->
  <div class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-pink-100/50 shadow-xl">
    <div class="max-w-4xl mx-auto px-6 py-4">
      <div class="flex items-end gap-3">
        <div class="flex-1 relative">
          <textarea id="message-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." class="w-full bg-white border border-pink-200 rounded-xl px-4 py-3 text-slate-800 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent resize-none min-h-[52px] max-h-32 shadow-sm"></textarea>
        </div>
        <button id="send-button" class="btn bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 hover:from-pink-600 hover:via-purple-600 hover:to-blue-600 text-white rounded-xl p-3 shadow-lg">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22,2 15,22 11,13 2,9"></polygon>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <script>
    /***** ãƒ‡ãƒ¼ã‚¿ï¼šæ­£å¼ãƒ©ãƒ™ãƒ«ã®ã¿ *****/
    const REASON_FLOW = {"è»¢è·ç†ç”±_åˆ†é¡ãƒ•ãƒ­ãƒ¼":[
      {"ã‚«ãƒ†ã‚´ãƒª":"çµŒå–¶ãƒ»çµ„ç¹”ã«é–¢ã™ã‚‹ã“ã¨","ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰":["ç†å¿µ","æ–¹é‡","ä¾¡å€¤è¦³","çµŒå–¶","é‹å–¶","ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ","æ–¹å‘æ€§","ãƒ“ã‚¸ãƒ§ãƒ³","ãƒŸãƒƒã‚·ãƒ§ãƒ³","è€ƒãˆæ–¹","å§¿å‹¢","çµŒå–¶é™£","ãƒˆãƒƒãƒ—","é¢¨é€šã—","æ„è¦‹","ç™ºè¨€","è©•ä¾¡åˆ¶åº¦","è©•ä¾¡","æ˜‡çµ¦","æ˜‡æ ¼","å…¬å¹³","åŸºæº–","æ•™è‚²ä½“åˆ¶","ç ”ä¿®","ãƒãƒ‹ãƒ¥ã‚¢ãƒ«","OJT","ãƒ•ã‚©ãƒ­ãƒ¼","æ•™è‚²","ã‚µãƒãƒ¼ãƒˆ","çµŒå–¶è€…","åŒ»ç™‚è·","ç¾å ´ç†è§£","å£²ä¸Š","æ•°å­—"],"å†…éƒ¨å€™è£œ":["MVVãƒ»çµŒå–¶ç†å¿µã«å…±æ„Ÿã§ãã‚‹è·å ´ã§åƒããŸã„","é¢¨é€šã—ãŒã‚ˆãæ„è¦‹ãŒè¨€ã„ã‚„ã™ã„è·å ´ã§åƒããŸã„","è©•ä¾¡åˆ¶åº¦ãŒå°å…¥ã•ã‚Œã¦ã„ã‚‹è·å ´ã§åƒããŸã„","æ•™è‚²ä½“åˆ¶ãŒæ•´å‚™ã•ã‚Œã¦ã„ã‚‹è·å ´ã§åƒããŸã„","çµŒå–¶è€…ãŒåŒ»ç™‚è·ã®ã¨ã“ã‚ã§åƒããŸã„","çµŒå–¶è€…ãŒåŒ»ç™‚è·ã§ã¯ãªã„ã¨ã“ã‚ã§åƒããŸã„"]},
      {"ã‚«ãƒ†ã‚´ãƒª":"åƒãä»²é–“ã«é–¢ã™ã‚‹ã“ã¨","ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰":["äººé–“é–¢ä¿‚","è·å ´ã®é›°å›²æ°—","ä¸Šå¸","å…ˆè¼©","åŒåƒš","ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯","ã„ã˜ã‚","ãƒ‘ãƒ¯ãƒãƒ©","ã‚»ã‚¯ãƒãƒ©","é™°å£","æ´¾é–¥","ãŠå±€","ç†ä¸å°½","ç›¸è«‡ã§ããªã„","å­¤ç«‹","ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³","ãƒ­ãƒ¼ãƒ«ãƒ¢ãƒ‡ãƒ«","å°Šæ•¬","æ†§ã‚Œ","è¦‹ç¿’ã„ãŸã„","ä¾¡å€¤è¦³","æ¸©åº¦æ„Ÿ","ã‚„ã‚‹æ°—","ä¿¡é ¼","å“æ ¼","ä¸€è²«æ€§","ç›®æ¨™","æ‰‹æœ¬","è·ç¨®","é€£æº","åŠ©ã‘åˆã„","å£","åˆ†æ–­","å¤æ ª","æ¨©åŠ›","åœ§","æ”¯é…"],"å†…éƒ¨å€™è£œ":["äººé–“é–¢ä¿‚ã®ãƒˆãƒ©ãƒ–ãƒ«ãŒå°‘ãªã„è·å ´ã§åƒããŸã„","åŒã˜ä¾¡å€¤è¦³ã‚’æŒã¤ä»²é–“ã¨åƒããŸã„","å°Šæ•¬ã§ãã‚‹ä¸Šå¸ãƒ»çµŒå–¶è€…ã¨åƒããŸã„","ãƒ­ãƒ¼ãƒ«ãƒ¢ãƒ‡ãƒ«ã¨ãªã‚‹ä¸Šå¸ã‚„å…ˆè¼©ãŒã»ã—ã„","è·ç¨®é–¢ä¿‚ãªãä¸€ä½“æ„ŸãŒã‚ã‚‹ä»²é–“ã¨åƒããŸã„","ãŠå±€ãŒã„ãªã„è·å ´ã§åƒããŸã„"]},
      {"ã‚«ãƒ†ã‚´ãƒª":"ä»•äº‹å†…å®¹ãƒ»ã‚­ãƒ£ãƒªã‚¢ã«é–¢ã™ã‚‹ã“ã¨","ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰":["ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—","æˆé•·","æŒ‘æˆ¦","ã‚„ã‚ŠãŒã„","æ¥­å‹™å†…å®¹","å°‚é–€æ€§","ç ”ä¿®","æ•™è‚²","ã‚­ãƒ£ãƒªã‚¢","æ˜‡é€²","æ˜‡æ ¼","è³‡æ ¼å–å¾—","çµŒé¨“","å­¦ã¹ã‚‹","æ–°ã—ã„","å¹…ã‚’åºƒã’ã‚‹","å¼·ã¿","æ´»ã‹ã™","è³‡æ ¼","å¾—æ„","æœªçµŒé¨“","åˆ†é‡","æ‚£è€…","åˆ©ç”¨è€…","è²¢çŒ®","å®Ÿæ„Ÿ","æ›¸é¡","ä»¶æ•°","å½¹ç«‹ã¤","ã‚ã‚ŠãŒã¨ã†","è²¬ä»»","å½¹è·","æ©Ÿä¼š","é“ç­‹","ç™»ç”¨"],"å†…éƒ¨å€™è£œ":["ä»Šã¾ã§ã®çµŒé¨“ã‚„è‡ªåˆ†ã®å¼·ã¿ã‚’æ´»ã‹ã—ãŸã„","æœªçµŒé¨“ã®ä»•äº‹ï¼åˆ†é‡ã«æŒ‘æˆ¦ã—ãŸã„","ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã—ãŸã„","æ‚£è€…ãƒ»åˆ©ç”¨è€…ã¸ã®è²¢çŒ®å®Ÿæ„Ÿã‚’æ„Ÿã˜ã‚‰ã‚Œã‚‹ä»•äº‹ã«æºã‚ã‚Œã‚‹","æ˜‡é€²ãƒ»æ˜‡æ ¼ã®æ©Ÿä¼šãŒã‚ã‚‹"]},
      {"ã‚«ãƒ†ã‚´ãƒª":"åŠ´åƒæ¡ä»¶ã«é–¢ã™ã‚‹ã“ã¨","ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰":["æ®‹æ¥­","å¤œå‹¤","ä¼‘æ—¥","æœ‰çµ¦","åƒãæ–¹","æ™‚é–“","ã‚·ãƒ•ãƒˆ","å‹¤å‹™æ™‚é–“","é€£å‹¤","ä¼‘æ†©","ã‚ªãƒ³ã‚³ãƒ¼ãƒ«","å‘¼ã³å‡ºã—","å‰¯æ¥­","å…¼æ¥­","ç¤¾ä¼šä¿é™º","è¨ºç™‚æ™‚é–“","è‡ªå·±ç ”é‘½","å‹‰å¼·","å­¦ç¿’","ç ”ä¿®æ™‚é–“","ç›´è¡Œç›´å¸°","äº‹å‹™æ‰€","ç«‹ã¡å¯„ã‚Š","æœç¤¼","æ—¥å ±","å®šæ™‚","ã‚µãƒ¼ãƒ“ã‚¹æ®‹æ¥­","ç”³è«‹åˆ¶","äººå“¡é…ç½®","å¸Œæœ›æ—¥","åŠä¼‘","æ™‚é–“æœ‰ä¼‘","æ‰¿èª","å°±æ¥­è¦å‰‡","å…¼æ¥­","è¨±å¯","å¥åº·ä¿é™º","é›‡ç”¨ä¿é™º","åŠ´ç½","æ‰‹ç¶šã","å§‹æ¥­å‰","æº–å‚™","æ¸…æƒ","æ‰“åˆ»"],"å†…éƒ¨å€™è£œ":["ç›´è¡Œç›´å¸°ãŒã§ãã‚‹è·å ´ã§åƒããŸã„","æ®‹æ¥­ã®ãªã„è·å ´ã§åƒããŸã„","å¸Œæœ›é€šã‚Šã«æœ‰çµ¦ãŒå–å¾—ã§ãã‚‹è·å ´ã§åƒããŸã„","å‰¯æ¥­OKãªè·å ´ã§åƒããŸã„","ç¤¾ä¼šä¿é™ºã‚’å®Œå‚™ã—ã¦ã„ã‚‹è·å ´ã§åƒããŸã„","è¨ºç™‚æ™‚é–“å†…ã§è‡ªå·±ç ”é‘½ã§ãã‚‹è·å ´ã§åƒããŸã„","å‰æ®‹æ¥­ã®ãªã„è·å ´ã§åƒããŸã„"]},
      {"ã‚«ãƒ†ã‚´ãƒª":"ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã«é–¢ã™ã‚‹ã“ã¨","ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰":["å®¶åº­","è‚²å…","å­è‚²ã¦","ä¸¡ç«‹","ãƒ©ã‚¤ãƒ•ã‚¹ãƒ†ãƒ¼ã‚¸","å­ã©ã‚‚","å®¶æ—","ä»‹è­·","ä¿è‚²åœ’","é€è¿","å­¦æ ¡è¡Œäº‹","é€šé™¢","ç™ºç†±","ä¸­æŠœã‘","æ™‚çŸ­","ã‚¤ãƒ™ãƒ³ãƒˆ","é£²ã¿ä¼š","BBQ","ç¤¾å“¡æ—…è¡Œ","æ—©æœæ¸…æƒ","å¼·åˆ¶","æ¥­å‹™å¤–","å°±æ¥­å¾Œ","ä¼‘æ—¥","ã‚ªãƒ•","ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ","ä»²è‰¯ã","äº¤æµ","ã”ã¯ã‚“","è¶£å‘³"],"å†…éƒ¨å€™è£œ":["å®¶åº­ã¨ã®ä¸¡ç«‹ã«ç†è§£ã®ã‚ã‚‹è·å ´ã§åƒããŸã„","å‹¤å‹™æ™‚é–“å¤–ã§ã‚¤ãƒ™ãƒ³ãƒˆãŒãªã„è·å ´ã§åƒããŸã„","ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã§ã‚‚ä»²è‰¯ãã—ã¦ã„ã‚‹è·å ´ã§åƒããŸã„"]},
      {"ã‚«ãƒ†ã‚´ãƒª":"è·å ´ç’°å¢ƒãƒ»è¨­å‚™","ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰":["è¨­å‚™","ç’°å¢ƒ","æ–½è¨­","å™¨æ¢°","æ©Ÿå™¨","ã‚·ã‚¹ãƒ†ãƒ ","IT","ãƒ‡ã‚¸ã‚¿ãƒ«","å¤ã„","æ–°ã—ã„","æœ€æ–°","è¨­ç½®","å°å…¥","æ•´å‚™"],"å†…éƒ¨å€™è£œ":[]},
      {"ã‚«ãƒ†ã‚´ãƒª":"è·å ´ã®å®‰å®šæ€§","ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰":["å®‰å®š","å°†æ¥æ€§","çµŒå–¶çŠ¶æ³","å€’ç”£","ãƒªã‚¹ãƒˆãƒ©","ä¸å®‰","ç¶™ç¶š","æŒç¶š","æˆé•·","ç™ºå±•","å°†æ¥","å…ˆè¡Œã"],"å†…éƒ¨å€™è£œ":[]},
      {"ã‚«ãƒ†ã‚´ãƒª":"çµ¦ä¸ãƒ»å¾…é‡","ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰":["çµ¦æ–™","çµ¦ä¸","å¹´å","æœˆå","æ‰‹å–ã‚Š","è³ä¸","ãƒœãƒ¼ãƒŠã‚¹","æ˜‡çµ¦","æ‰‹å½“","å¾…é‡","ç¦åˆ©åšç”Ÿ","å®‰ã„","ä½ã„","ä¸ŠãŒã‚‰ãªã„","ç”Ÿæ´»ã§ããªã„","ãŠé‡‘"],"å†…éƒ¨å€™è£œ":[]}
    ]};

    // must/want è¾æ›¸ï¼ˆå¿…è¦éƒ¨åˆ†ï¼‰
    const MUSTWANT = {
      "categories": {
        "å‹¤å‹™æ¡ä»¶": {
          "å‹¤å‹™æ™‚é–“": ["æ—¥å‹¤ã®ã¿å¯","å¤œå‹¤å°‚å¾“ã‚ã‚Š","2äº¤æ›¿åˆ¶","3äº¤æ›¿åˆ¶","åˆå‰ã®ã¿å‹¤å‹™","åˆå¾Œã®ã¿å‹¤å‹™","æ®‹æ¥­ã»ã¼ãªã—","ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ãªã—ãƒ»å…é™¤å¯","ç·Šæ€¥è¨ªå•ãªã—","æ™‚å·®å‡ºå‹¤å°å…¥","ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ åˆ¶åº¦ã‚ã‚Š","æ®‹æ¥­æœˆ20æ™‚é–“ä»¥å†…","ã‚¹ã‚­ãƒæ™‚é–“å‹¤å‹™","æ™‚çŸ­å‹¤å‹™ç›¸è«‡å¯"]
        },
        "ã‚¢ã‚¯ã‚»ã‚¹": { "ã‚¢ã‚¯ã‚»ã‚¹": ["é§…è¿‘ï¼ˆ5åˆ†ä»¥å†…ï¼‰","ç›´è¡Œç›´å¸°OK","è»Šé€šå‹¤å¯","ãƒã‚¤ã‚¯é€šå‹¤å¯","è‡ªè»¢è»Šé€šå‹¤å¯","é§è»Šå ´å®Œå‚™"] },
        "ä¼‘æ—¥": { "ä¼‘æ—¥": ["åœŸæ—¥ç¥ä¼‘ã¿","é€±ä¼‘2æ—¥","é€±ä¼‘3æ—¥","æœ‰çµ¦æ¶ˆåŒ–ç‡ã»ã¼100%"] }
      }
    };
    const MW_FLAT = (()=>{ const out=[]; const c=MUSTWANT.categories; Object.values(c).forEach(sub=>Object.values(sub).forEach(arr=>out.push(...arr))); return out;})();

    // â˜… åŒç¾©èªâ†’æ­£å¼ãƒ©ãƒ™ãƒ«ï¼ˆæœ€ä½é™ï¼‰
    const SYNONYMS = {
      "ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ãªã—": "ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ãªã—ãƒ»å…é™¤å¯",
      "ã‚ªãƒ³ã‚³ãƒ¼ãƒ«å…é™¤": "ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ãªã—ãƒ»å…é™¤å¯",
      "ã‚ªãƒ³ã‚³ãƒ¼ãƒ«NG": "ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ãªã—ãƒ»å…é™¤å¯",
      "å¤œé–“å‘¼ã³å‡ºã—ãªã—": "ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ãªã—ãƒ»å…é™¤å¯",
      "ç›´è¡Œç›´å¸°": "ç›´è¡Œç›´å¸°OK",
      "è»Šé€šå‹¤": "è»Šé€šå‹¤å¯",
      "é§è»Šå ´ã‚ã‚Š": "é§è»Šå ´å®Œå‚™",
      "åœŸæ—¥ä¼‘ã¿": "åœŸæ—¥ç¥ä¼‘ã¿",
      "å¤œå‹¤ãªã—": "æ—¥å‹¤ã®ã¿å¯",   // å³å¯†ã‚¿ã‚°ã¯ã€Œå¤œå‹¤ãªã—ã€ã§ã¯ãªã„ã®ã§å¯„ã›ã‚‹
      "æ®‹æ¥­ãªã—": "æ®‹æ¥­ã»ã¼ãªã—"
    };

    /***** çŠ¶æ…‹ *****/
    let currentStep = 0; // 0:åŸºæœ¬ â†’ 1:ç†ç”± â†’ 2:Must â†’ 3:Want â†’ 4:Can â†’ 5:Will
    let isNumberConfirmed = false;
    let deepDrill = 0;
    let awaitingKind = null;   // 'reason'|'must'|'want'
    let pendingOptions = [];
    let reasonHistory = [];

    const session = {
      candidateNumber:'', qualification:'', workplace:'',
      reasonTag:null, mustTags:[], wantTags:[], canText:'', willText:''
    };

    /***** UI *****/
    function addMessage(type, content){
      const wrap=document.getElementById('messages');
      const row=document.createElement('div');
      row.className='flex '+(type==='user'?'justify-end':'justify-start')+' message-enter';
      row.innerHTML=`
        <div class="flex max-w-xs lg:max-w-2xl ${type==='user'?'flex-row-reverse':'flex-row'} items-start gap-3">
          <div class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${type==='user'?'bg-gradient-to-r from-pink-400 via-purple-400 to-blue-400 text-white':'bg-gradient-to-r from-gray-100 to-gray-200 border-2 border-white'}">
            ${type==='user' ? '<svg width="18" height="18" viewBox="0 0 24 24" stroke="currentColor"><circle cx="12" cy="7" r="4"></circle></svg>' : 'ğŸ¤–'}
          </div>
          <div class="rounded-2xl px-4 py-3 ${type==='user'?'bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 text-white ml-auto':'bg-white/90 text-slate-700 border border-pink-100/50'}">
            <div class="text-sm whitespace-pre-wrap leading-relaxed">${content}</div>
          </div>
        </div>`;
      wrap.appendChild(row); row.scrollIntoView({behavior:'smooth',block:'end'});
    }
    function updateChips(){
      const set=(id,text,ghost)=>{const el=document.getElementById(id); el.textContent=text; el.classList.toggle('chip-ghost',!!ghost);};
      set('chip-id','ç•ªå·ï¼š'+(session.candidateNumber||'æœªå…¥åŠ›'), !session.candidateNumber);
      set('chip-qual','è·ç¨®ï¼š'+(session.qualification||'æœªå…¥åŠ›'), !session.qualification);
      set('chip-work','å‹¤å‹™å…ˆï¼š'+(session.workplace||'æœªå…¥åŠ›'), !session.workplace);
      set('chip-reason','è»¢è·ç†ç”±ï¼š'+(session.reasonTag||'æœªè¨­å®š'), !session.reasonTag);
      set('chip-must','Mustï¼š'+session.mustTags.length+'ä»¶', session.mustTags.length===0);
      set('chip-want','Wantï¼š'+session.wantTags.length+'ä»¶', session.wantTags.length===0);
    }
    function updateProgressBar(){
      const pct=((currentStep+1)/6)*100;
      document.getElementById('progress-bar').style.width=pct+'%';
      document.getElementById('current-step').textContent=currentStep+1;
      document.getElementById('step-label').textContent=['åŸºæœ¬æƒ…å ±','è»¢è·ç†ç”±','çµ¶å¯¾æ¡ä»¶','å¸Œæœ›æ¡ä»¶','çµŒé¨“','æŒ‘æˆ¦'][currentStep];
      document.getElementById('number-required').style.display=(currentStep===0 && !isNumberConfirmed)?'block':'none';
      updateChips();
    }
    function showOptions(options, kind){
      const allow = (kind==='reason')
        ? new Set(REASON_FLOW['è»¢è·ç†ç”±_åˆ†é¡ãƒ•ãƒ­ãƒ¼'].flatMap(x=>x['å†…éƒ¨å€™è£œ']))
        : new Set(MW_FLAT);
      const filtered=[...options].filter(o=>allow.has(o)).slice(0,3);
      if(filtered.length===0){ hideOptions(); return; }
      const box=document.getElementById('option-box');
      const area=document.getElementById('option-buttons');
      area.innerHTML=''; pendingOptions=filtered; awaitingKind=kind;
      filtered.forEach(label=>{
        const b=document.createElement('button');
        b.className='btn chip'; b.textContent='ã€'+label+'ã€';
        b.addEventListener('click',()=>onPick(label));
        area.appendChild(b);
      });
      box.classList.remove('hidden');
    }
    function hideOptions(){
      document.getElementById('option-box').classList.add('hidden');
      document.getElementById('option-buttons').innerHTML='';
      pendingOptions=[]; awaitingKind=null;
    }

    /***** è§£æ *****/
    function parseInitialThree(text){
      const num=text.match(/\d{2,}/);
      const result={number:null,qual:null,work:null};
      if(num) result.number=num[0];
      const rest=(num?text.replace(num[0],''):text).trim();
      if(rest){
        const parts=rest.split(/[,\sã€€\/]+/).filter(Boolean);
        if(parts[0]) result.qual=parts[0];
        if(parts[1]) result.work=parts.slice(1).join(' ');
      }
      return result;
    }
    function countMatches(text, words){
      const t=text.toLowerCase(); return words.reduce((a,w)=>a+(t.includes(String(w).toLowerCase())?1:0),0);
    }
    function pickReasonCategoryFromHistory(){
      const joined = reasonHistory.join(' ');
      const items = REASON_FLOW['è»¢è·ç†ç”±_åˆ†é¡ãƒ•ãƒ­ãƒ¼'].map(rec=>({
        cat: rec['ã‚«ãƒ†ã‚´ãƒª'],
        score: countMatches(joined, rec['ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰']),
        options: rec['å†…éƒ¨å€™è£œ']
      })).sort((a,b)=>b.score-a.score);
      if(items.length===0 || items[0].score===0) return [];
      // ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå„ªå…ˆï¼ˆå·®ãŒå°ã•ã‘ã‚Œã°å„ªå…ˆï¼‰
      const privWords=["å®¶åº­","è‚²å…","å­è‚²ã¦","ä¸¡ç«‹","ãƒ©ã‚¤ãƒ•ã‚¹ãƒ†ãƒ¼ã‚¸","å­ã©ã‚‚","å®¶æ—","ä»‹è­·"];
      const priHit=countMatches(joined,privWords)>0;
      if(priHit){
        const pri=items.find(i=>i.cat==="ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã«é–¢ã™ã‚‹ã“ã¨");
        if(pri && (items[0].cat==="ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã«é–¢ã™ã‚‹ã“ã¨" || (items[0].score-pri.score)<2)) return [pri];
      }
      const top=items[0].score; return items.filter(i=>i.score===top);
    }
    function bestFromMustWant(text){
      let normalized=text;
      Object.entries(SYNONYMS).forEach(([k,v])=>{
        const re=new RegExp(k,'g'); normalized=normalized.replace(re,v);
      });
      const t=normalized.toLowerCase();
      const scored=MW_FLAT.map(item=>{
        const low=item.toLowerCase(); let s=0;
        if(t.includes(low)) s+=3;
        t.split(/[ \n\r\tã€ã€‚ãƒ»,ï¼Œ!ï¼?ï¼Ÿ]+/).forEach(tok=>{ if(tok && low.includes(tok)) s+=1; });
        return {item,score:s};
      }).filter(x=>x.score>0).sort((a,b)=>b.score-a.score).map(x=>x.item);
      return [...new Set(scored)].slice(0,3);
    }

    /***** å£èª¿ *****/
    const EMPATHY = {
      reason: ['ãã‚Œã¯ã—ã‚“ã©ã„ã‚ˆã­ã€‚','ã†ã‚“ã€ãã®çŠ¶æ³ã¯ãã¤ã„ã€‚','ãªã‚‹ã»ã©ã­ã€ã‚ã‹ã‚‹ã€‚'],
      must:   ['OKã€å¤§äº‹ãªæ¡ä»¶ã ã­ã€‚','äº†è§£ã€ãã‚Œã¯å¤–ã›ãªã„ã­ã€‚','ã†ã‚“ã€ãã“ã¯çµ¶å¯¾ã ã‚ˆã­ã€‚'],
      want:   ['ã„ã„ã­ã€ã‚¤ãƒ¡ãƒ¼ã‚¸è¦‹ãˆã¦ããŸã‚ˆã€‚','äº†è§£ã€ãã®æ–¹å‘ã„ã„ã­ã€‚','ã†ã‚“ã€ãã®æ„Ÿã˜ãŒã‚ã‚‹ã¨åƒãã‚„ã™ã„ã‚ˆã­ã€‚']
    };
    const DRILL = {
      reason: ['ã©ã®å ´é¢ã§ä¸€ç•ªãã†æ„Ÿã˜ãŸï¼Ÿ','ä¸€ç•ªã®ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã¯ã©ã“ï¼Ÿ','ã‚‚ã†å°‘ã—è©³ã—ãèã„ã¦ã‚‚ã„ã„ï¼Ÿ','ãã‚ŒãŒç¶šãã¨ä½•ãŒå›°ã‚‹ï¼Ÿ'],
      must:   ['å¯¾è±¡ã‚„æ¡ä»¶ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã€ã‚‚ã†å°‘ã—å…·ä½“çš„ã«æ•™ãˆã¦ï¼','é »åº¦ã‚„æ°´æº–ã¯ã©ã®ãã‚‰ã„ã‚’æƒ³å®šã—ã¦ã‚‹ï¼Ÿ','å ´æ‰€ã‚„åƒãæ–¹ã®å‰æã¯ã‚ã‚‹ï¼Ÿ'],
      want:   ['ã‚ã‚‹ã¨å¬‰ã—ã„ãƒã‚¤ãƒ³ãƒˆã€å…·ä½“çš„ã«ã©ã®è¾ºï¼Ÿ','ã©ã®ãã‚‰ã„ã®é »åº¦/æ°´æº–ã ã¨ã¡ã‚‡ã†ã©ã„ã„ï¼Ÿ','ä»–ã«ã‚‚è¿‘ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚ã‚‹ï¼Ÿ']
    };
    const pick = arr => arr[Math.floor(Math.random()*arr.length)];

    /***** é¸æŠ *****/
    function onPick(label){
      hideOptions();
      if(awaitingKind==='reason'){
        addMessage('ai', `${pick(EMPATHY.reason)}\nã¤ã¾ã‚Šã€${label}ã€ã£ã¦ã“ã¨ã ã­ï¼`);
        session.reasonTag=label; updateChips();
        addMessage('ai','ã‚ã‚ŠãŒã¨ã†ï¼');
        // â†’ Step2ã¸
        deepDrill=0; currentStep=2; updateProgressBar();
        addMessage('ai',
`ã˜ã‚ƒã‚æ¬¡ã®è³ªå•ï¼
ä»Šå›ã®è»¢è·ã§ã“ã‚Œã ã‘ã¯çµ¶å¯¾è­²ã‚Œãªã„ï¼ã¨ã„ã†ã®ã‚’æ•™ãˆã¦ï¼
ä»•äº‹å†…å®¹ã§ã‚‚ã€åˆ¶åº¦ã§ã‚‚ã€æ¡ä»¶ã§ã‚‚OKâ—

ä¾‹ãˆã°ãƒ»ãƒ»ãƒ»
ã€Œçµ¶å¯¾åœŸæ—¥ä¼‘ã¿ã˜ã‚ƒãªã„ã¨å›°ã‚‹ï¼ã€
ã€Œçµ¶å¯¾ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ã¯ã§ããªã„ï¼ã€`);
      }else if(awaitingKind==='must'){
        addMessage('ai', `ãã£ã‹ã€ã€${label}ã€ãŒçµ¶å¯¾ã£ã¦ã“ã¨ã ã­ï¼`);
        session.mustTags.push(label); updateChips();
        addMessage('ai','ã‚ã‚ŠãŒã¨ã†ï¼');
        addMessage('ai','ä»–ã«ã‚‚çµ¶å¯¾æ¡ä»¶ã¯ã‚ã‚‹ï¼Ÿï¼ˆãªã‘ã‚Œã°ã€Œãªã„ã€ï¼‰');
      }else if(awaitingKind==='want'){
        addMessage('ai', `äº†è§£ï¼ã€${label}ã€ã ã¨å¬‰ã—ã„ã£ã¦ã“ã¨ã ã­ï¼`);
        session.wantTags.push(label); updateChips();
        addMessage('ai','ã‚ã‚ŠãŒã¨ã†ï¼');
        addMessage('ai','ä»–ã«ã‚‚ã‚ã£ãŸã‚‰ã„ã„ãªã£ã¦ã„ã†ã®ã¯ã‚ã‚‹ï¼Ÿï¼ˆãªã‘ã‚Œã°ã€Œãªã„ã€ï¼‰');
      }
    }

    /***** ãƒ¡ã‚¤ãƒ³ *****/
    async function processMessage(raw){
      const message=String(raw||'').trim(); if(!message) return;

      // å€™è£œè¡¨ç¤ºä¸­ã§ã‚‚ã€é¸æŠã‚’å¼·åˆ¶ã—ãªã„ï¼ˆè‡ªç„¶æ–‡ã§ç¶šã‘ã‚‰ã‚Œã‚‹ï¼‰
      if(awaitingKind && pendingOptions.length){
        const typed=pendingOptions.find(o=>message.includes(o));
        if(typed){ onPick(typed); return; }
      }

      // Step0ï¼š3ã¤ï¼ˆç•ªå·ãŒç„¡ã„ã¨é€²ã¾ãªã„ï¼‰
      if(currentStep===0){
        const parsed=parseInitialThree(message);
        if(!parsed.number){ addMessage('ai','æœ€åˆã«ã€Œæ±‚è·è€…ç•ªå·ã€ã ã‘æ•™ãˆã¦ã­ï¼ï¼ˆæ•°å­—ã§OKï¼‰'); return; }
        session.candidateNumber=parsed.number; isNumberConfirmed=true;
        if(parsed.qual) session.qualification=parsed.qual;
        if(parsed.work) session.workplace=parsed.work;
        updateChips();

        if(!session.qualification){ addMessage('ai',`æ±‚è·è€…ç•ªå·ï¼š${session.candidateNumber} å—ã‘å–ã£ãŸã‚ˆã€‚ä»Šã®è·ç¨®ã¯ï¼Ÿ`); return; }
        if(!session.workplace){ addMessage('ai',`OKã€ä»Šã®è·ç¨®ã¯ã€${session.qualification}ã€ã­ã€‚ä»Šã©ã“ã§åƒã„ã¦ã‚‹ï¼Ÿ`); return; }

        addMessage('ai','ã‚ã‚ŠãŒã¨ã†ï¼');
        currentStep=1; updateProgressBar();
        addMessage('ai','ã¯ã˜ã‚ã«ã€ä»Šå›ã®è»¢è·ç†ç”±ã‚’æ•™ãˆã¦ã»ã—ã„ãªã€‚ãã£ã‹ã‘ã£ã¦ã©ã‚“ãªã“ã¨ã ã£ãŸï¼Ÿ\nã—ã‚“ã©ã„ã¨æ€ã£ãŸã“ã¨ã€ã“ã‚Œã¯ã‚‚ã†ç„¡ç†ã£ã¦æ€ã£ãŸã“ã¨ã€é€†ã«ã“ã†ã„ã†ã“ã¨ã«æŒ‘æˆ¦ã—ãŸã„ï¼ã£ã¦æ€ã£ãŸã“ã¨ã€ä½•ã§ã‚‚OKã ã‚ˆâ—');
        return;
      }

      // Step1ï¼šè»¢è·ç†ç”±ï¼ˆâ˜…ã“ã“ã¯ã€Œæ·±æ˜ã‚Š or å€™è£œã€ã ã‘ï¼â€œä»–ã¯ã‚ã‚‹ï¼Ÿâ€ç¦æ­¢ï¼‰
      if(currentStep===1){
        reasonHistory.push(message); // å±¥æ­´ãƒ™ãƒ¼ã‚¹åˆ¤å®š
        addMessage('ai', pick(EMPATHY.reason));

        const tops=pickReasonCategoryFromHistory();
        if(tops.length>1){
          addMessage('ai', `${tops[0].cat} ã¨ ${tops[1].cat} ã®ä¸¡æ–¹ãŒè¿‘ãã†ã€‚ä»Šã¯ã©ã£ã¡ãŒã‚ˆã‚Šé‡è¦ï¼Ÿ\nA) ${tops[0].cat}\nB) ${tops[1].cat}`);
          window.__tie={a:tops[0],b:tops[1]}; currentStep=1.1; return;
        }
        const chosen = tops.length===1 ? tops[0] : null;

        if(deepDrill<2){ deepDrill++; addMessage('ai', pick(DRILL.reason)); return; }

        // 3å›ç›®â†’å€™è£œæç¤ºï¼ˆå†…éƒ¨å€™è£œãŒç©º or æœªãƒãƒƒãƒã¯é€šéï¼‰
        const opts = (chosen && chosen.options) ? chosen.options.slice(0,3) : [];
        if(!opts.length){
          addMessage('ai','ã‚ã‚ŠãŒã¨ã†ï¼');
          deepDrill=0; currentStep=2; updateProgressBar();
          addMessage('ai',
`ã˜ã‚ƒã‚æ¬¡ã®è³ªå•ï¼
ä»Šå›ã®è»¢è·ã§ã“ã‚Œã ã‘ã¯çµ¶å¯¾è­²ã‚Œãªã„ï¼ã¨ã„ã†ã®ã‚’æ•™ãˆã¦ï¼
ä»•äº‹å†…å®¹ã§ã‚‚ã€åˆ¶åº¦ã§ã‚‚ã€æ¡ä»¶ã§ã‚‚OKâ—

ä¾‹ãˆã°ãƒ»ãƒ»ãƒ»
ã€Œçµ¶å¯¾åœŸæ—¥ä¼‘ã¿ã˜ã‚ƒãªã„ã¨å›°ã‚‹ï¼ã€
ã€Œçµ¶å¯¾ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ã¯ã§ããªã„ï¼ã€`);
          return;
        }
        showOptions(opts,'reason'); return;
      }
      if(currentStep===1.1){
        if(!window.__tie){ currentStep=1; return processMessage(message); }
        const pickAB = /^a\b/i.test(message) ? window.__tie.a : (/^b\b/i.test(message) ? window.__tie.b : null);
        if(!pickAB){ currentStep=1; return processMessage(message); }
        if(deepDrill<2){ deepDrill++; addMessage('ai', pick(DRILL.reason)); currentStep=1; return; }
        const opts=(pickAB.options||[]).slice(0,3);
        if(!opts.length){
          addMessage('ai','ã‚ã‚ŠãŒã¨ã†ï¼');
          deepDrill=0; currentStep=2; updateProgressBar();
          addMessage('ai',
`ã˜ã‚ƒã‚æ¬¡ã®è³ªå•ï¼
ä»Šå›ã®è»¢è·ã§ã“ã‚Œã ã‘ã¯çµ¶å¯¾è­²ã‚Œãªã„ï¼ã¨ã„ã†ã®ã‚’æ•™ãˆã¦ï¼
ä»•äº‹å†…å®¹ã§ã‚‚ã€åˆ¶åº¦ã§ã‚‚ã€æ¡ä»¶ã§ã‚‚OKâ—

ä¾‹ãˆã°ãƒ»ãƒ»ãƒ»
ã€Œçµ¶å¯¾åœŸæ—¥ä¼‘ã¿ã˜ã‚ƒãªã„ã¨å›°ã‚‹ï¼ã€
ã€Œçµ¶å¯¾ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ã¯ã§ããªã„ï¼ã€`);
          return;
        }
        showOptions(opts,'reason'); currentStep=1; return;
      }

      // Step2ï¼šMust
      if(currentStep===2){
        if (/^ãªã„$|^ç„¡ã—$|^ãªã—$/i.test(message)){
          addMessage('ai','ã‚ã‚ŠãŒã¨ã†ï¼');
          currentStep=3; updateProgressBar();
          addMessage('ai','ãã‚Œã˜ã‚ƒã‚æ¬¡ã«ã€ã“ã†ã ã£ãŸã‚‰ã„ã„ãªã€ã¨ã„ã†ã®ã‚’æ•™ãˆã¦ã„ãã­ã€‚ä»•äº‹å†…å®¹ã§ã‚‚ã€åˆ¶åº¦ã§ã‚‚ã€æ¡ä»¶é¢ã§ã‚‚OKâ—');
          return;
        }
        addMessage('ai', pick(EMPATHY.must));
        const cands=bestFromMustWant(message);
        if(cands.length){ showOptions(cands,'must'); return; }
        if(!window.__must) window.__must={drill:0};
        if(window.__must.drill<2){ window.__must.drill++; addMessage('ai', pick(DRILL.must)); return; }
        addMessage('ai','ã‚ã‚ŠãŒã¨ã†ï¼');
        addMessage('ai','ä»–ã«ã‚‚çµ¶å¯¾æ¡ä»¶ã¯ã‚ã‚‹ï¼Ÿï¼ˆãªã‘ã‚Œã°ã€Œãªã„ã€ï¼‰');
        return;
      }

      // Step3ï¼šWant
      if(currentStep===3){
        if (/^ãªã„$|^ç„¡ã—$|^ãªã—$/i.test(message)){
          addMessage('ai','è³ªå•ã¯æ®‹ã‚Š2ã¤ï¼');
          currentStep=4; updateProgressBar();
          addMessage('ai','ã“ã‚Œã¾ã§ã‚„ã£ã¦ããŸã“ã¨ã‚’æ•™ãˆã¦ã­ã€‚ã–ã£ãã‚Šã§OKï¼');
          return;
        }
        addMessage('ai', pick(EMPATHY.want));
        const cands=bestFromMustWant(message);
        if(cands.length){ showOptions(cands,'want'); return; }
        if(!window.__want) window.__want={drill:0};
        if(window.__want.drill<2){ window.__want.drill++; addMessage('ai', pick(DRILL.want)); return; }
        addMessage('ai','ã‚ã‚ŠãŒã¨ã†ï¼');
        addMessage('ai','ä»–ã«ã‚‚ã‚ã£ãŸã‚‰ã„ã„ãªã£ã¦ã„ã†ã®ã¯ã‚ã‚‹ï¼Ÿï¼ˆãªã‘ã‚Œã°ã€Œãªã„ã€ï¼‰');
        return;
      }

      // Step4ï¼šCan
      if(currentStep===4){
        session.canText=message; addMessage('ai','ã‚ã‚ŠãŒã¨ã†ï¼');
        currentStep=5; updateProgressBar();
        addMessage('ai','ã“ã‚ŒãŒæœ€å¾Œï¼ä»Šå›ã®è»¢è·ã§å¶ãˆãŸã„æŒ‘æˆ¦ã‚„ã€å¤¢ã¯ã‚ã‚‹ï¼Ÿ');
        return;
      }

      // Step5ï¼šWill
      if(currentStep===5){
        session.willText=message; addMessage('ai','ã‚ã‚ŠãŒã¨ã†ï¼');
        currentStep=6; updateProgressBar();
        const summary =
`ğŸ“‹ åé›†ãƒ‡ãƒ¼ã‚¿ï¼ˆå†…éƒ¨ä¿å­˜ï¼‰
æ±‚è·è€…ç•ªå·ï¼š${session.candidateNumber||'æœªå…¥åŠ›'}
è·ç¨®ï¼š${session.qualification||'æœªå…¥åŠ›'}
å‹¤å‹™å…ˆï¼š${session.workplace||'æœªå…¥åŠ›'}
è»¢è·ç†ç”±ï¼š${session.reasonTag||'æœªè¨­å®š'}
Mustï¼š${session.mustTags.length?session.mustTags.join('ã€'):'æœªè¨­å®š'}
Wantï¼š${session.wantTags.length?session.wantTags.join('ã€'):'æœªè¨­å®š'}
æ´»ã‹ã—ãŸã„çµŒé¨“ï¼š${session.canText||'æœªå…¥åŠ›'}
æŒ‘æˆ¦ã—ãŸã„ã“ã¨ï¼š${session.willText||'æœªå…¥åŠ›'}`;
        addMessage('ai', summary);
        return;
      }
    }

    /***** é€ä¿¡ *****/
    document.getElementById('send-button').addEventListener('click',()=>{
      const input=document.getElementById('message-input');
      const text=input.value.trim(); if(!text) return;
      addMessage('user',text); input.value='';
      processMessage(text);
    });
    document.getElementById('message-input').addEventListener('keypress',(e)=>{
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); document.getElementById('send-button').click(); }
    });

    // init
    updateProgressBar();
  </script>
</body>
</html>
