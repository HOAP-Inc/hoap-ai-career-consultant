<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOAP AI ã‚­ãƒ£ãƒªã‚¢ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #fdf2f8 0%, #faf5ff 50%, #eff6ff 100%);
        }
        .gradient-text {
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 50%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .message-enter {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .typing {
            display: inline-block;
            animation: pulse 1.5s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-slate-800">
    <!-- Header -->
    <div class="bg-white/90 backdrop-blur-sm border-b border-pink-100 sticky top-0 z-10 shadow-sm">
        <div class="max-w-4xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold gradient-text">
                        HOAP AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
                    </h1>
                    <p class="text-slate-600 text-sm">ã‚­ãƒ£ãƒªã‚¢ç›¸è«‡ãƒ»ä¸€æ¬¡ãƒ’ã‚¢ãƒªãƒ³ã‚°</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-slate-500">Step <span id="current-step">1</span>/6</div>
                    <div class="text-xs gradient-text font-medium">
                        <span id="step-label">åŸºæœ¬æƒ…å ±</span>
                        <span id="number-required" class="block text-red-400 text-xs mt-1">â€»æ±‚è·è€…ç•ªå·å¿…é ˆ</span>
                    </div>
                </div>
            </div>
            
            <!-- Progress Bar -->
            <div class="mt-4 bg-gradient-to-r from-pink-100 to-blue-100 rounded-full h-1">
                <div id="progress-bar"
                     class="bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 h-1 rounded-full transition-all duration-500 shadow-sm"
                     style="width: 16.67%">
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Area -->
    <div class="max-w-4xl mx-auto px-6 py-8 pb-32">
        <div id="messages" class="space-y-6">
            <!-- Initial message -->
            <div class="flex justify-start">
                <div class="flex max-w-xs lg:max-w-2xl items-start gap-3">
                    <div class="flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-r from-gray-100 to-gray-200 shadow-md border-2 border-white flex items-center justify-center">
                        <span class="text-xl">ğŸ¤–</span>
                    </div>
                    <div class="bg-white/90 backdrop-blur-sm text-slate-700 border border-pink-100/50 rounded-2xl px-4 py-3 shadow-sm">
                        <div class="text-sm whitespace-pre-wrap leading-relaxed">ã“ã‚“ã«ã¡ã¯ï¼
æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®é¢è«‡ãŒã‚¹ãƒ ãƒ¼ã‚ºã«é€²ã‚€ã‚ˆã†ã«ã€HOAPã®AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å°‘ã—ã ã‘è©±ã‚’èã‹ã›ã¦ã­ã€‚

ã„ãã¤ã‹è³ªå•ã‚’ã—ã¦ã„ãã­ã€‚
æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®é¢è«‡ã§ã—ã£ã‹ã‚Šãƒ’ã‚¢ãƒªãƒ³ã‚°ã™ã‚‹ã‹ã‚‰ã€ä»Šæ—¥ã¯è‡ªåˆ†ã®è»¢è·ã«ã¤ã„ã¦æ”¹ã‚ã¦æ•´ç†ã™ã‚‹æ„Ÿã˜ã§ã€æ°—æ¥½ã«è©±ã—ã¦ã­ï¼

ã¾ãš3ã¤æ•™ãˆã¦ï¼
â‘ æ±‚è·è€…ç•ªå·â‘¡ä»Šã®è·ç¨®â‘¢ä»Šã©ã“ã§åƒã„ã¦ã‚‹ï¼Ÿ</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Input Area -->
    <div class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-pink-100/50 shadow-xl">
        <div class="max-w-4xl mx-auto px-6 py-4">
            <div class="flex items-end gap-3">
                <div class="flex-1 relative">
                    <textarea
                        id="message-input"
                        placeholder="æ±‚è·è€…ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."
                        class="w-full bg-white border border-pink-200 rounded-xl px-4 py-3 text-slate-800 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent resize-none min-h-[52px] max-h-32 shadow-sm"
                        rows="1"></textarea>
                </div>
                <button
                    id="send-button"
                    class="bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 hover:from-pink-600 hover:via-purple-600 hover:to-blue-600 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed text-white rounded-xl p-3 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105"
                >
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22,2 15,22 11,13 2,9"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
        let currentStep = 0;
        let candidateNumber = '';
        let isNumberConfirmed = false;
        let sessionData = {
            candidateNumber: '',
            qualification: '',
            workplace: '',
            transferReason: '',
            mustConditions: [],
            wantConditions: [],
            canDo: '',
            willDo: ''
        };
        let deepDrillCount = 0;
        let awaitingSelection = false;
        let selectionOptions = [];

        const steps = [
            { label: 'åŸºæœ¬æƒ…å ±', description: 'è³‡æ ¼ãƒ»ç¾è·' },
            { label: 'è»¢è·ç†ç”±', description: 'ãã£ã‹ã‘' },
            { label: 'çµ¶å¯¾æ¡ä»¶', description: 'Mustæ¡ä»¶' },
            { label: 'å¸Œæœ›æ¡ä»¶', description: 'Wantæ¡ä»¶' },
            { label: 'çµŒé¨“', description: 'ã“ã‚Œã¾ã§' },
            { label: 'æŒ‘æˆ¦', description: 'ã“ã‚Œã‹ã‚‰' }
        ];

        // è»¢è·ç†ç”±ãƒ‡ãƒ¼ã‚¿
        const transferReasonFlow = {
            "çµŒå–¶ãƒ»çµ„ç¹”ã«é–¢ã™ã‚‹ã“ã¨": {
                "keywords": ["ç†å¿µ", "æ–¹é‡", "ä¾¡å€¤è¦³", "çµŒå–¶", "é‹å–¶", "ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ", "æ–¹å‘æ€§", "ãƒ“ã‚¸ãƒ§ãƒ³", "ãƒŸãƒƒã‚·ãƒ§ãƒ³", "è€ƒãˆæ–¹", "å§¿å‹¢", "çµŒå–¶é™£", "ãƒˆãƒƒãƒ—", "é¢¨é€šã—", "æ„è¦‹", "ç™ºè¨€", "è©•ä¾¡åˆ¶åº¦", "è©•ä¾¡", "æ˜‡çµ¦", "æ˜‡æ ¼", "å…¬å¹³", "åŸºæº–", "æ•™è‚²ä½“åˆ¶", "ç ”ä¿®", "ãƒãƒ‹ãƒ¥ã‚¢ãƒ«", "OJT", "ãƒ•ã‚©ãƒ­ãƒ¼", "æ•™è‚²", "ã‚µãƒãƒ¼ãƒˆ", "çµŒå–¶è€…", "åŒ»ç™‚è·", "ç¾å ´ç†è§£", "å£²ä¸Š", "æ•°å­—"],
                "internal_options": [
                    "MVVãƒ»çµŒå–¶ç†å¿µã«å…±æ„Ÿã§ãã‚‹è·å ´ã§åƒããŸã„",
                    "é¢¨é€šã—ãŒã‚ˆãæ„è¦‹ãŒè¨€ã„ã‚„ã™ã„è·å ´ã§åƒããŸã„", 
                    "è©•ä¾¡åˆ¶åº¦ãŒå°å…¥ã•ã‚Œã¦ã„ã‚‹è·å ´ã§åƒããŸã„",
                    "æ•™è‚²ä½“åˆ¶ãŒæ•´å‚™ã•ã‚Œã¦ã„ã‚‹è·å ´ã§åƒããŸã„",
                    "çµŒå–¶è€…ãŒåŒ»ç™‚è·ã®ã¨ã“ã‚ã§åƒããŸã„",
                    "çµŒå–¶è€…ãŒåŒ»ç™‚è·ã§ã¯ãªã„ã¨ã“ã‚ã§åƒããŸã„"
                ]
            },
            "åƒãä»²é–“ã«é–¢ã™ã‚‹ã“ã¨": {
                "keywords": ["äººé–“é–¢ä¿‚", "è·å ´ã®é›°å›²æ°—", "ä¸Šå¸", "å…ˆè¼©", "åŒåƒš", "ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯", "ã„ã˜ã‚", "ãƒ‘ãƒ¯ãƒãƒ©", "ã‚»ã‚¯ãƒãƒ©", "é™°å£", "æ´¾é–¥", "ãŠå±€", "ç†ä¸å°½", "ç›¸è«‡ã§ããªã„", "å­¤ç«‹", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³", "ãƒ­ãƒ¼ãƒ«ãƒ¢ãƒ‡ãƒ«", "å°Šæ•¬", "æ†§ã‚Œ", "è¦‹ç¿’ã„ãŸã„", "ä¾¡å€¤è¦³", "æ¸©åº¦æ„Ÿ", "ã‚„ã‚‹æ°—", "ä¿¡é ¼", "å“æ ¼", "ä¸€è²«æ€§", "ç›®æ¨™", "æ‰‹æœ¬", "è·ç¨®", "é€£æº", "åŠ©ã‘åˆã„", "å£", "åˆ†æ–­", "å¤æ ª", "æ¨©åŠ›", "åœ§", "æ”¯é…"],
                "internal_options": [
                    "äººé–“é–¢ä¿‚ã®ãƒˆãƒ©ãƒ–ãƒ«ãŒå°‘ãªã„è·å ´ã§åƒããŸã„",
                    "åŒã˜ä¾¡å€¤è¦³ã‚’æŒã¤ä»²é–“ã¨åƒããŸã„", 
                    "å°Šæ•¬ã§ãã‚‹ä¸Šå¸ãƒ»çµŒå–¶è€…ã¨åƒããŸã„",
                    "ãƒ­ãƒ¼ãƒ«ãƒ¢ãƒ‡ãƒ«ã¨ãªã‚‹ä¸Šå¸ã‚„å…ˆè¼©ãŒã»ã—ã„",
                    "è·ç¨®é–¢ä¿‚ãªãä¸€ä½“æ„ŸãŒã‚ã‚‹ä»²é–“ã¨åƒããŸã„",
                    "ãŠå±€ãŒã„ãªã„è·å ´ã§åƒããŸã„"
                ]
            },
            "ä»•äº‹å†…å®¹ãƒ»ã‚­ãƒ£ãƒªã‚¢ã«é–¢ã™ã‚‹ã“ã¨": {
                "keywords": ["ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—", "æˆé•·", "æŒ‘æˆ¦", "ã‚„ã‚ŠãŒã„", "æ¥­å‹™å†…å®¹", "å°‚é–€æ€§", "ç ”ä¿®", "æ•™è‚²", "ã‚­ãƒ£ãƒªã‚¢", "æ˜‡é€²", "æ˜‡æ ¼", "è³‡æ ¼å–å¾—", "çµŒé¨“", "å­¦ã¹ã‚‹", "æ–°ã—ã„", "å¹…ã‚’åºƒã’ã‚‹", "çµŒé¨“", "å¼·ã¿", "æ´»ã‹ã™", "è³‡æ ¼", "å¾—æ„", "æœªçµŒé¨“", "åˆ†é‡", "æ‚£è€…", "åˆ©ç”¨è€…", "è²¢çŒ®", "å®Ÿæ„Ÿ", "æ›¸é¡", "ä»¶æ•°", "å½¹ç«‹ã¤", "ã‚ã‚ŠãŒã¨ã†", "è²¬ä»»", "å½¹è·", "æ©Ÿä¼š", "é“ç­‹", "ç™»ç”¨"],
                "internal_options": [
                    "ä»Šã¾ã§ã®çµŒé¨“ã‚„è‡ªåˆ†ã®å¼·ã¿ã‚’æ´»ã‹ã—ãŸã„",
                    "æœªçµŒé¨“ã®ä»•äº‹ï¼åˆ†é‡ã«æŒ‘æˆ¦ã—ãŸã„",
                    "ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã—ãŸã„",
                    "æ‚£è€…ãƒ»åˆ©ç”¨è€…ã¸ã®è²¢çŒ®å®Ÿæ„Ÿã‚’æ„Ÿã˜ã‚‰ã‚Œã‚‹ä»•äº‹ã«æºã‚ã‚Œã‚‹",
                    "æ˜‡é€²ãƒ»æ˜‡æ ¼ã®æ©Ÿä¼šãŒã‚ã‚‹"
                ]
            },
            "åŠ´åƒæ¡ä»¶ã«é–¢ã™ã‚‹ã“ã¨": {
                "keywords": ["æ®‹æ¥­", "å¤œå‹¤", "ä¼‘æ—¥", "æœ‰çµ¦", "åƒãæ–¹", "æ™‚é–“", "ã‚·ãƒ•ãƒˆ", "å‹¤å‹™æ™‚é–“", "é€£å‹¤", "ä¼‘æ†©", "ã‚ªãƒ³ã‚³ãƒ¼ãƒ«", "å‘¼ã³å‡ºã—", "å‰¯æ¥­", "å…¼æ¥­", "ç¤¾ä¼šä¿é™º", "ä¿é™º", "å¥ä¿", "åšç”Ÿå¹´é‡‘", "è¨ºç™‚æ™‚é–“", "è‡ªå·±ç ”é‘½", "å‹‰å¼·", "å­¦ç¿’", "ç ”ä¿®æ™‚é–“", "ç›´è¡Œç›´å¸°", "äº‹å‹™æ‰€", "ç«‹ã¡å¯„ã‚Š", "æœç¤¼", "æ—¥å ±", "å®šæ™‚", "ã‚µãƒ¼ãƒ“ã‚¹æ®‹æ¥­", "ç”³è«‹åˆ¶", "äººå“¡é…ç½®", "å¸Œæœ›æ—¥", "åŠä¼‘", "æ™‚é–“æœ‰ä¼‘", "æ‰¿èª", "å°±æ¥­è¦å‰‡", "å…¼æ¥­", "è¨±å¯", "å¥åº·ä¿é™º", "é›‡ç”¨ä¿é™º", "åŠ´ç½", "æ‰‹ç¶šã", "å§‹æ¥­å‰", "æº–å‚™", "æ¸…æƒ", "æ‰“åˆ»"],
                "internal_options": [
                    "ç›´è¡Œç›´å¸°ãŒã§ãã‚‹è·å ´ã§åƒããŸã„",
                    "æ®‹æ¥­ã®ãªã„è·å ´ã§åƒããŸã„", 
                    "å¸Œæœ›é€šã‚Šã«æœ‰çµ¦ãŒå–å¾—ã§ãã‚‹è·å ´ã§åƒããŸã„",
                    "å‰¯æ¥­OKãªè·å ´ã§åƒããŸã„",
                    "ç¤¾ä¼šä¿é™ºã‚’å®Œå‚™ã—ã¦ã„ã‚‹è·å ´ã§åƒããŸã„",
                    "è¨ºç™‚æ™‚é–“å†…ã§è‡ªå·±ç ”é‘½ã§ãã‚‹è·å ´ã§åƒããŸã„",
                    "å‰æ®‹æ¥­ã®ãªã„è·å ´ã§åƒããŸã„"
                ]
            },
            "ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã«é–¢ã™ã‚‹ã“ã¨": {
                "keywords": ["å®¶åº­", "è‚²å…", "å­è‚²ã¦", "ä¸¡ç«‹", "ãƒ©ã‚¤ãƒ•ã‚¹ãƒ†ãƒ¼ã‚¸", "å­ã©ã‚‚", "å®¶æ—", "ä»‹è­·", "ä¿è‚²åœ’", "é€è¿", "å­¦æ ¡è¡Œäº‹", "é€šé™¢", "ç™ºç†±", "ä¸­æŠœã‘", "æ™‚çŸ­", "ã‚¤ãƒ™ãƒ³ãƒˆ", "é£²ã¿ä¼š", "BBQ", "ç¤¾å“¡æ—…è¡Œ", "æ—©æœæ¸…æƒ", "å¼·åˆ¶", "æ¥­å‹™å¤–", "å°±æ¥­å¾Œ", "ä¼‘æ—¥", "ã‚ªãƒ•", "ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ", "ä»²è‰¯ã", "äº¤æµ", "ã”ã¯ã‚“", "è¶£å‘³"],
                "internal_options": [
                    "å®¶åº­ã¨ã®ä¸¡ç«‹ã«ç†è§£ã®ã‚ã‚‹è·å ´ã§åƒããŸã„",
                    "å‹¤å‹™æ™‚é–“å¤–ã§ã‚¤ãƒ™ãƒ³ãƒˆãŒãªã„è·å ´ã§åƒããŸã„", 
                    "ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã§ã‚‚ä»²è‰¯ãã—ã¦ã„ã‚‹è·å ´ã§åƒããŸã„"
                ]
            },
            "è·å ´ç’°å¢ƒãƒ»è¨­å‚™": {
                "keywords": ["è¨­å‚™", "ç’°å¢ƒ", "æ–½è¨­", "å™¨æ¢°", "æ©Ÿå™¨", "ã‚·ã‚¹ãƒ†ãƒ ", "IT", "ãƒ‡ã‚¸ã‚¿ãƒ«", "å¤ã„", "æ–°ã—ã„", "æœ€æ–°", "è¨­ç½®", "å°å…¥", "æ•´å‚™"],
                "internal_options": []
            },
            "è·å ´ã®å®‰å®šæ€§": {
                "keywords": ["å®‰å®š", "å°†æ¥æ€§", "çµŒå–¶çŠ¶æ³", "å€’ç”£", "ãƒªã‚¹ãƒˆãƒ©", "ä¸å®‰", "ç¶™ç¶š", "æŒç¶š", "æˆé•·", "ç™ºå±•", "å°†æ¥", "å…ˆè¡Œã"],
                "internal_options": []
            },
            "çµ¦ä¸ãƒ»å¾…é‡": {
                "keywords": ["çµ¦æ–™", "çµ¦ä¸", "å¹´å", "æœˆå", "æ‰‹å–ã‚Š", "è³ä¸", "ãƒœãƒ¼ãƒŠã‚¹", "æ˜‡çµ¦", "æ‰‹å½“", "å¾…é‡", "ç¦åˆ©åšç”Ÿ", "å®‰ã„", "ä½ã„", "ä¸ŠãŒã‚‰ãªã„", "ç”Ÿæ´»ã§ããªã„", "ãŠé‡‘"],
                "internal_options": []
            }
        };

        // mustwantè¾æ›¸
        const mustWantDict = {
            "ã‚µãƒ¼ãƒ“ã‚¹å½¢æ…‹": {
                "åŒ»ç™‚": ["æ€¥æ€§æœŸç—…æ£Ÿ", "å›å¾©æœŸç—…æ£Ÿ", "æ…¢æ€§æœŸãƒ»ç™‚é¤Šå‹ç—…é™¢", "ä¸€èˆ¬ç—…é™¢", "åœ°åŸŸåŒ…æ‹¬ã‚±ã‚¢ç—…æ£Ÿ", "ç™‚é¤Šç—…æ£Ÿ", "ç·©å’Œã‚±ã‚¢ç—…æ£Ÿï¼ˆãƒ›ã‚¹ãƒ”ã‚¹ï¼‰", "ã‚¯ãƒªãƒ‹ãƒƒã‚¯", "ç²¾ç¥ç§‘ç—…é™¢", "è¨ªå•çœ‹è­·ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³", "ç²¾ç¥ç§‘ç‰¹åŒ–å‹è¨ªå•çœ‹è­·ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³", "æ©Ÿèƒ½å¼·åŒ–å‹è¨ªå•çœ‹è­·ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³", "è¨ªå•ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³", "è¨ªå•æ „é¤ŠæŒ‡å°"],
                "ä»‹è­·": ["é€šæ‰€ä»‹è­·ï¼ˆãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹ï¼‰", "èªçŸ¥ç—‡å¯¾å¿œå‹é€šæ‰€ä»‹è­·ï¼ˆèªçŸ¥ç—‡å°‚é–€ãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹ï¼‰", "åœ°åŸŸå¯†ç€å‹é€šæ‰€ä»‹è­·ï¼ˆå®šå“¡18åä»¥ä¸‹ï¼‰", "é€šæ‰€ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ‡ã‚¤ã‚±ã‚¢ï¼‰", "è¨ªå•ä»‹è­·", "å®šæœŸå·¡å›ãƒ»éšæ™‚å¯¾å¿œå‹è¨ªå•ä»‹è­·çœ‹è­·", "è¨ªå•å…¥æµ´", "å°è¦æ¨¡å¤šæ©Ÿèƒ½å‹å±…å®…ä»‹è­·", "çœ‹è­·å°è¦æ¨¡å¤šæ©Ÿèƒ½å‹å±…å®…ä»‹è­·", "ç‰¹åˆ¥é¤Šè­·è€äººãƒ›ãƒ¼ãƒ ", "åœ°åŸŸå¯†ç€å‹ç‰¹åˆ¥é¤Šè­·è€äººãƒ›ãƒ¼ãƒ ï¼ˆå®šå“¡29åä»¥ä¸‹ï¼‰", "ä»‹è­·è€äººä¿å¥æ–½è¨­", "ä»‹è­·ä»˜ãæœ‰æ–™è€äººãƒ›ãƒ¼ãƒ ", "ã‚·ãƒ§ãƒ¼ãƒˆã‚¹ãƒ†ã‚¤ï¼ˆçŸ­æœŸå…¥æ‰€ç”Ÿæ´»ä»‹è­·ï¼‰", "ã‚µãƒ¼ãƒ“ã‚¹ä»˜ãé«˜é½¢è€…å‘ã‘ä½å®…ï¼ˆã‚µé«˜ä½ï¼‰", "ä½å®…å‹æœ‰æ–™è€äººãƒ›ãƒ¼ãƒ ", "è»½è²»è€äººãƒ›ãƒ¼ãƒ ï¼ˆã‚±ã‚¢ãƒã‚¦ã‚¹ï¼‰", "å¥åº·å‹æœ‰æ–™è€äººãƒ›ãƒ¼ãƒ ", "ã‚·ãƒ‹ã‚¢å‘ã‘åˆ†è­²ãƒãƒ³ã‚·ãƒ§ãƒ³"],
                "éšœå®³ç¦ç¥‰": ["æ”¾èª²å¾Œç­‰ãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹", "ç”Ÿæ´»ä»‹è­·ï¼ˆéšœå®³è€…ã®æ—¥ä¸­æ´»å‹•ï¼‰", "å°±åŠ´ç¶™ç¶šæ”¯æ´Aå‹", "å°±åŠ´ç¶™ç¶šæ”¯æ´Bå‹", "çŸ­æœŸå…¥æ‰€ï¼ˆéšœå®³è€…å‘ã‘ã‚·ãƒ§ãƒ¼ãƒˆã‚¹ãƒ†ã‚¤ï¼‰"],
                "æ­¯ç§‘": ["æ­¯ç§‘ã‚¯ãƒªãƒ‹ãƒƒã‚¯", "è¨ªå•æ­¯ç§‘", "æ­¯ç§‘å£è…”å¤–ç§‘ï¼ˆç—…é™¢å†…è¨ºç™‚ç§‘ï¼‰", "å¤§å­¦ç—…é™¢æ­¯ç§‘ãƒ»æ­¯å­¦éƒ¨é™„å±ç—…é™¢", "æ­¯ç§‘æŠ€å·¥æ‰€", "é™¢å†…ãƒ©ãƒœ"],
                "ãã®ä»–": ["ä¿è‚²åœ’", "å¹¼ç¨šåœ’", "ä¼æ¥­ï¼ˆç”£æ¥­ä¿å¥ãƒ»ä¼æ¥­å†…çœ‹è­·ãªã©ï¼‰"]
            },
            "å‹¤å‹™æ¡ä»¶": {
                "ä¼‘æ—¥": ["4é€±8ä¼‘ä»¥ä¸Š", "è‚²å…æ”¯æ´ã‚ã‚Š", "å¹´é–“ä¼‘æ—¥120æ—¥ä»¥ä¸Š", "é€±1æ—¥ã‹ã‚‰OK", "é€±2æ—¥ã‹ã‚‰OK", "åœŸæ—¥ç¥ä¼‘ã¿", "å®¶åº­éƒ½åˆä¼‘OK", "æœˆ1ã‚·ãƒ•ãƒˆæå‡º", "æ¯é€±ï½éš”é€±ã‚·ãƒ•ãƒˆæå‡º", "æœ‰çµ¦æ¶ˆåŒ–ç‡ã»ã¼100%", "é•·æœŸä¼‘æš‡ã‚ã‚Š", "é€±ä¼‘2æ—¥", "é€±ä¼‘3æ—¥"],
                "å‹¤å‹™æ™‚é–“": ["æ—¥å‹¤ã®ã¿å¯", "å¤œå‹¤å°‚å¾“ã‚ã‚Š", "2äº¤æ›¿åˆ¶", "3äº¤æ›¿åˆ¶", "åˆå‰ã®ã¿å‹¤å‹™", "åˆå¾Œã®ã¿å‹¤å‹™", "æ®‹æ¥­ã»ã¼ãªã—", "ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ãªã—ãƒ»å…é™¤å¯", "ç·Šæ€¥è¨ªå•ãªã—", "æ™‚å·®å‡ºå‹¤å°å…¥", "ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ åˆ¶åº¦ã‚ã‚Š", "æ®‹æ¥­æœˆ20æ™‚é–“ä»¥å†…", "ã‚¹ã‚­ãƒæ™‚é–“å‹¤å‹™", "æ™‚çŸ­å‹¤å‹™ç›¸è«‡å¯"],
                "ã‚¢ã‚¯ã‚»ã‚¹": ["é§…è¿‘ï¼ˆ5åˆ†ä»¥å†…ï¼‰", "è»Šé€šå‹¤å¯", "ãƒã‚¤ã‚¯é€šå‹¤å¯", "è‡ªè»¢è»Šé€šå‹¤å¯", "é§è»Šå ´å®Œå‚™", "ç›´è¡Œç›´å¸°OK"],
                "çµ¦ä¸ãƒ»è³ä¸": ["å¹´å300ä¸‡ä»¥ä¸Š", "å¹´å350ä¸‡ä»¥ä¸Š", "å¹´å400ä¸‡ä»¥ä¸Š", "å¹´å450ä¸‡ä»¥ä¸Š", "å¹´å500ä¸‡ä»¥ä¸Š", "å¹´å550ä¸‡ä»¥ä¸Š", "å¹´å600ä¸‡ä»¥ä¸Š", "å¹´å650ä¸‡ä»¥ä¸Š", "å¹´å700ä¸‡ä»¥ä¸Š", "è³ä¸ã‚ã‚Š", "é€€è·é‡‘ã‚ã‚Š"],
                "ç¦åˆ©åšç”Ÿ": ["å¯®ã‚ã‚Šãƒ»ç¤¾å®…ã‚ã‚Š", "è¨—å…æ‰€ãƒ»ä¿è‚²æ”¯æ´ã‚ã‚Š", "ç¤¾ä¼šä¿é™ºå®Œå‚™", "äº¤é€šè²»æ”¯çµ¦", "æ‰¶é¤Šæ§é™¤å†…è€ƒæ…®", "å¾©è·æ”¯æ´", "ä½å®…æ‰‹å½“", "å‰¯æ¥­OK", "æ—¥ãƒ»ç¥æ—¥çµ¦ä¸UP", "å¼•è¶Šã—æ‰‹å½“", "ç·Šæ€¥è¨ªå•æ™‚ã®æ‰‹å½“ãƒ»ä»£ä¼‘ã‚ã‚Š", "ã‚¹ãƒãƒ›ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè²¸ä¸ã‚ã‚Š", "é›»å‹•ã‚¢ã‚·ã‚¹ãƒˆè‡ªè»¢è»Šãƒ»ãƒã‚¤ã‚¯ãƒ»è»Šè²¸ä¸", "ç¤¾å‰²ã‚ã‚Š", "ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆç›¸è«‡çª“å£ã‚ã‚Š"],
                "æ•™è‚²ä½“åˆ¶ãƒ»ç ”ä¿®åˆ¶åº¦": ["ç ”ä¿®åˆ¶åº¦ã‚ã‚Š", "è³‡æ ¼å–å¾—æ”¯æ´ã‚ã‚Š", "ã‚»ãƒŸãƒŠãƒ¼å‚åŠ è²»è£œåŠ©ã‚ã‚Š", "ãƒãƒ‹ãƒ¥ã‚¢ãƒ«å®Œå‚™", "å‹•ç”»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚ã‚Š", "è©•ä¾¡åˆ¶åº¦ã‚ã‚Š", "ãƒ¡ãƒ³ã‚¿ãƒ¼åˆ¶åº¦ã‚ã‚Š", "ç‹¬ç«‹ãƒ»é–‹æ¥­æ”¯æ´ã‚ã‚Š", "é™¢é•·ãƒ»åˆ†é™¢é•·å€™è£œ", "æ‹…å½“åˆ¶"]
            }
        };

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function flattenMustWantDict() {
            const allItems = [];
            Object.values(mustWantDict).forEach(mainCategory => {
                Object.values(mainCategory).forEach(subItems => {
                    if (Array.isArray(subItems)) {
                        allItems.push(...subItems);
                    }
                });
            });
            return allItems;
        }

        function updateProgressBar() {
            const progress = ((currentStep + 1) / 6) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('current-step').textContent = currentStep + 1;
            document.getElementById('step-label').textContent = steps[currentStep].label;
            
            const numberRequired = document.getElementById('number-required');
            if (currentStep === 0 && !isNumberConfirmed) {
                numberRequired.style.display = 'block';
            } else {
                numberRequired.style.display = 'none';
            }
        }

        function addMessage(type, content) {
            const messagesContainer = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${type === 'user' ? 'justify-end' : 'justify-start'} message-enter`;
            
            messageDiv.innerHTML = `
                <div class="flex max-w-xs lg:max-w-2xl ${type === 'user' ? 'flex-row-reverse' : 'flex-row'} items-start gap-3">
                    <div class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center overflow-hidden ${
                        type === 'user' 
                            ? 'bg-gradient-to-r from-pink-400 via-purple-400 to-blue-400 text-white shadow-md' 
                            : 'bg-gradient-to-r from-gray-100 to-gray-200 shadow-md border-2 border-white'
                    }">
                        ${type === 'user' ? 
                            '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>' : 
                            '<span class="text-xl">ğŸ¤–</span>'
                        }
                    </div>
                    <div class="rounded-2xl px-4 py-3 shadow-sm ${
                        type === 'user'
                            ? 'bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 text-white ml-auto shadow-lg'
                            : 'bg-white/90 backdrop-blur-sm text-slate-700 border border-pink-100/50'
                    }">
                        <div class="text-sm whitespace-pre-wrap leading-relaxed">${content}</div>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }

        function showTyping() {
            const messagesContainer = document.getElementById('messages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'flex justify-start';
            
            typingDiv.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-r from-gray-100 to-gray-200 shadow-md border-2 border-white flex items-center justify-center">
                        <span class="text-xl">ğŸ¤–</span>
                    </div>
                    <div class="bg-white/90 backdrop-blur-sm border border-pink-100/50 rounded-2xl px-4 py-3 shadow-sm">
                        <div class="flex items-center gap-2 text-slate-500">
                            <div class="typing">â—</div>
                            <div class="typing" style="animation-delay: 0.2s">â—</div>
                            <div class="typing" style="animation-delay: 0.4s">â—</div>
                            <span class="text-sm ml-2">å›ç­”ã‚’æº–å‚™ä¸­...</span>
                        </div>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(typingDiv);
            typingDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }

        function hideTyping() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ãƒ¡ã‚¤ãƒ³é–¢æ•°
        async function processMessage(message) {
            showTyping();
            
            // å°‘ã—å¾…æ©Ÿï¼ˆãƒªã‚¢ãƒ«ãªæ„Ÿã˜ã‚’å‡ºã™ãŸã‚ï¼‰
            await new Promise(resolve => setTimeout(resolve, 800));
            
            let response = '';
            let shouldUpdateStep = false;

            // Step0: æ±‚è·è€…ç•ªå·ãƒã‚§ãƒƒã‚¯
            if (currentStep === 0) {
                if (!isNumberConfirmed) {
                    const numberMatch = message.match(/\d+/);
                    if (numberMatch) {
                        const extractedNumber = numberMatch[0];
                        candidateNumber = extractedNumber;
                        sessionData.candidateNumber = extractedNumber;
                        isNumberConfirmed = true;
                        response = `æ±‚è·è€…ç•ªå·ï¼š${extractedNumber} ã§ã™ã­ï¼
ä»–ã®æƒ…å ±ã‚‚ãŠèã‹ã›ãã ã•ã„ã€‚
â‘¡ä»Šã®è·ç¨®â‘¢ä»Šã©ã“ã§åƒã„ã¦ã‚‹ï¼Ÿ`;
                    } else {
                        response = `ã™ã¿ã¾ã›ã‚“ã€æœ€åˆã«æ±‚è·è€…ç•ªå·ã‚’æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ
â‘ æ±‚è·è€…ç•ªå·â‘¡ä»Šã®è·ç¨®â‘¢ä»Šã©ã“ã§åƒã„ã¦ã‚‹ï¼Ÿ
ã®é †ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚`;
                    }
                } else {
                    sessionData.qualification = message;
                    currentStep = 1;
                    shouldUpdateStep = true;
                    response = `ã‚ã‚ŠãŒã¨ã†ï¼

ã¯ã˜ã‚ã«ã€ä»Šå›ã®è»¢è·ç†ç”±ã‚’æ•™ãˆã¦ã»ã—ã„ãªã€‚ãã£ã‹ã‘ã£ã¦ã©ã‚“ãªã“ã¨ã ã£ãŸï¼Ÿ
ã—ã‚“ã©ã„ã¨æ€ã£ãŸã“ã¨ã€ã“ã‚Œã¯ã‚‚ã†ç„¡ç†ã£ã¦æ€ã£ãŸã“ã¨ã€é€†ã«ã“ã†ã„ã†ã“ã¨ã«æŒ‘æˆ¦ã—ãŸã„ï¼ã£ã¦æ€ã£ãŸã“ã¨ã€ä½•ã§ã‚‚OKã ã‚ˆâ—`;
                }
            }
            // Step1: è»¢è·ç†ç”±
            else if (currentStep === 1) {
                if (awaitingSelection) {
                    const selectedOption = selectionOptions.find(opt => message.includes(opt));
                    if (selectedOption) {
                        sessionData.transferReason = selectedOption;
                        awaitingSelection = false;
                        selectionOptions = [];
                        currentStep = 2;
                        shouldUpdateStep = true;
                        response = `ãªã‚‹ã»ã©ã€ãã‚Œã¯å¤§äº‹ã ã‚ˆã­ï¼ã¤ã¾ã‚Šã€Œ${selectedOption}ã€ã£ã¦ã“ã¨ã ã­ï¼

ã‚ã‚ŠãŒã¨ã†ï¼

ã˜ã‚ƒã‚æ¬¡ã®è³ªå•ï¼
ä»Šå›ã®è»¢è·ã§ã“ã‚Œã ã‘ã¯çµ¶å¯¾è­²ã‚Œãªã„ï¼ã¨ã„ã†ã®ã‚’æ•™ãˆã¦ï¼
ä»•äº‹å†…å®¹ã§ã‚‚ã€åˆ¶åº¦ã§ã‚‚ã€æ¡ä»¶ã§ã‚‚OKâ—

ä¾‹ãˆã°ãƒ»ãƒ»ãƒ»
ã€Œçµ¶å¯¾åœŸæ—¥ä¼‘ã¿ã˜ã‚ƒãªã„ã¨å›°ã‚‹ï¼ã€
ã€Œçµ¶å¯¾ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ã¯ã§ããªã„ï¼ã€

å¾Œã‹ã‚‰ã€ã‚ã‚‹ã¨ã„ã„ãªã€ã€ãªã„ã¨ã„ã„ãªã€ã«ã¤ã„ã¦ã‚‚èãã‹ã‚‰ã€ä»Šã¯ã€çµ¶å¯¾ï¼ã€ã¨ã„ã†ã‚‚ã®ã ã‘æ•™ãˆã¦ã­ã€‚`;
                    } else {
                        response = "é¸æŠè‚¢ã®ä¸­ã‹ã‚‰é¸ã‚“ã§ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ";
                    }
                } else {
                    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°
                    const keywordMatches = {};
                    Object.keys(transferReasonFlow).forEach(category => {
                        const keywords = transferReasonFlow[category].keywords;
                        let matchCount = 0;
                        keywords.forEach(keyword => {
                            if (message.toLowerCase().includes(keyword.toLowerCase())) {
                                matchCount++;
                            }
                        });
                        if (matchCount > 0) {
                            keywordMatches[category] = matchCount;
                        }
                    });

                    const maxMatches = Math.max(...Object.values(keywordMatches), 0);
                    const topCategories = Object.keys(keywordMatches).filter(cat => keywordMatches[cat] === maxMatches);

                    if (topCategories.length === 0) {
                        // æœªãƒãƒƒãƒå‡¦ç†
                        currentStep = 2;
                        shouldUpdateStep = true;
                        response = `ãªã‚‹ã»ã©ã€ãã®æ°—æŒã¡ã‚ˆãã‚ã‹ã‚‹ï¼å¤§äº‹ãªè»¢è·ã®ãã£ã‹ã‘ã ã­â—

ã‚ã‚ŠãŒã¨ã†ï¼

ã˜ã‚ƒã‚æ¬¡ã®è³ªå•ï¼
ä»Šå›ã®è»¢è·ã§ã“ã‚Œã ã‘ã¯çµ¶å¯¾è­²ã‚Œãªã„ï¼ã¨ã„ã†ã®ã‚’æ•™ãˆã¦ï¼
ä»•äº‹å†…å®¹ã§ã‚‚ã€åˆ¶åº¦ã§ã‚‚ã€æ¡ä»¶ã§ã‚‚OKâ—

ä¾‹ãˆã°ãƒ»ãƒ»ãƒ»
ã€Œçµ¶å¯¾åœŸæ—¥ä¼‘ã¿ã˜ã‚ƒãªã„ã¨å›°ã‚‹ï¼ã€
ã€Œçµ¶å¯¾ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ã¯ã§ããªã„ï¼ã€

å¾Œã‹ã‚‰ã€ã‚ã‚‹ã¨ã„ã„ãªã€ã€ãªã„ã¨ã„ã„ãªã€ã«ã¤ã„ã¦ã‚‚èãã‹ã‚‰ã€ä»Šã¯ã€çµ¶å¯¾ï¼ã€ã¨ã„ã†ã‚‚ã®ã ã‘æ•™ãˆã¦ã­ã€‚`;
                    } else {
                        const selectedCategory = topCategories[0];
                        const options = transferReasonFlow[selectedCategory].internal_options;

                        if (options.length === 0) {
                            // å†…éƒ¨å€™è£œãŒç©º
                            currentStep = 2;
                            shouldUpdateStep = true;
                            response = `ãªã‚‹ã»ã©ã€ãã®æ°—æŒã¡ã‚ˆãã‚ã‹ã‚‹ï¼å¤§äº‹ãªè»¢è·ã®ãã£ã‹ã‘ã ã­â—

ã‚ã‚ŠãŒã¨ã†ï¼

ã˜ã‚ƒã‚æ¬¡ã®è³ªå•ï¼
ä»Šå›ã®è»¢è·ã§ã“ã‚Œã ã‘ã¯çµ¶å¯¾è­²ã‚Œãªã„ï¼ã¨ã„ã†ã®ã‚’æ•™ãˆã¦ï¼
ä»•äº‹å†…å®¹ã§ã‚‚ã€åˆ¶åº¦ã§ã‚‚ã€æ¡ä»¶ã§ã‚‚OKâ—

ä¾‹ãˆã°ãƒ»ãƒ»ãƒ»
ã€Œçµ¶å¯¾åœŸæ—¥ä¼‘ã¿ã˜ã‚ƒãªã„ã¨å›°ã‚‹ï¼ã€
ã€Œçµ¶å¯¾ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ã¯ã§ããªã„ï¼ã€

å¾Œã‹ã‚‰ã€ã‚ã‚‹ã¨ã„ã„ãªã€ã€ãªã„ã¨ã„ã„ãªã€ã«ã¤ã„ã¦ã‚‚èãã‹ã‚‰ã€ä»Šã¯ã€çµ¶å¯¾ï¼ã€ã¨ã„ã†ã‚‚ã®ã ã‘æ•™ãˆã¦ã­ã€‚;                         } else {                             // æ·±æ˜ã‚Šã¾ãŸã¯å€™è£œæç¤º                             if (deepDrillCount < 2) {                                 deepDrillCount++;                                 const drillQuestions = [                                     "ãã‚Œã«ã¤ã„ã¦ã‚‚ã†å°‘ã—è©³ã—ãæ•™ãˆã¦",                                     "å…·ä½“çš„ã«ã¯ã©ã‚“ãªï¼Ÿ"                                 ];                                 response = drillQuestions[deepDrillCount - 1];                             } else {                                 // å€™è£œæç¤º                                 const candidateOptions = options.slice(0, 3);                                 const optionsList = candidateOptions.map(opt => ã€${opt}ã€).join('ï¼');                                 awaitingSelection = true;                                 selectionOptions = candidateOptions;                                 response = ã“ã®ä¸­ã ã¨ã©ã‚ŒãŒä¸€ç•ªè¿‘ã„ï¼Ÿ${optionsList};                             }                         }                     }                 }             }             // Step2: çµ¶å¯¾å¸Œæœ›             else if (currentStep === 2) {                 if (message.toLowerCase().includes('ãªã„') || message.toLowerCase().includes('ãªã—')) {                     currentStep = 3;                     shouldUpdateStep = true;                     response = ã‚ã‚ŠãŒã¨ã†ï¼
ãã‚Œã˜ã‚ƒã‚æ¬¡ã«ã€ã“ã†ã ã£ãŸã‚‰ã„ã„ãªã€ã¨ã„ã†ã®ã‚’èã„ã¦ã„ãã­ã€‚
ã“ã‚Œã‚‚ä»•äº‹å†…å®¹ã§ã‚‚ã€åˆ¶åº¦ã§ã‚‚ã€æ¡ä»¶é¢ã§ã‚‚ã€æ¡ä»¶ã§ã‚‚OKâ—
ä¾‹ãˆã°ãƒ»ãƒ»ãƒ»
ã€Œãƒã‚¤ã‚«ãƒ¼é€šå‹¤ãŒã§ãã‚‹ã¨å¬‰ã—ã„ãªã€
ã€Œã§ãã‚Œã°å¤œå‹¤ãŒãªã„ã¨ã„ã„ãªã€
ã£ã¦æ„Ÿã˜ï¼;                 } else if (awaitingSelection) {                     const selectedOption = selectionOptions.find(opt => message.includes(opt));                     if (selectedOption) {                         sessionData.mustConditions.push(selectedOption);                         awaitingSelection = false;                         selectionOptions = [];                         response = ãã£ã‹ã€${selectedOption}ãŒçµ¶å¯¾ã£ã¦ã“ã¨ã ã­ï¼
ä»–ã«ã‚‚çµ¶å¯¾æ¡ä»¶ã¯ã‚ã‚‹ï¼Ÿ`;
} else {
response = "é¸æŠè‚¢ã®ä¸­ã‹ã‚‰é¸ã‚“ã§ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ";
}
} else {
// mustwantè¾æ›¸ãƒãƒƒãƒãƒ³ã‚°
const allItems = flattenMustWantDict();
const matchedItems = allItems.filter(item => {
return message.toLowerCase().includes(item.toLowerCase()) ||
item.toLowerCase().includes(message.toLowerCase().split(' ')[0]);
});
                if (matchedItems.length === 0) {
                    response = `ãã£ã‹ã€ã‚ã‹ã£ãŸï¼å¤§äº‹ãªå¸Œæœ›ã ã­â—
ä»–ã«ã‚‚çµ¶å¯¾æ¡ä»¶ã¯ã‚ã‚‹ï¼Ÿ;                     } else {                         const topMatches = matchedItems.slice(0, 3);                         if (topMatches.length === 1) {                             sessionData.mustConditions.push(topMatches[0]);                             response = ãã£ã‹ã€${topMatches[0]}ãŒçµ¶å¯¾ã£ã¦ã“ã¨ã ã­ï¼
ä»–ã«ã‚‚çµ¶å¯¾æ¡ä»¶ã¯ã‚ã‚‹ï¼Ÿ;                         } else {                             const optionsList = topMatches.map(opt => ã€${opt}ã€).join('ï¼');                             awaitingSelection = true;                             selectionOptions = topMatches;                             response = ã“ã®ä¸­ã ã¨ã©ã‚ŒãŒä¸€ç•ªè¿‘ã„ï¼Ÿ${optionsList};                         }                     }                 }             }             // Step3: å¸Œæœ›æ¡ä»¶             else if (currentStep === 3) {                 if (message.toLowerCase().includes('ãªã„') || message.toLowerCase().includes('ãªã—')) {                     currentStep = 4;                     shouldUpdateStep = true;                     response = è³ªå•ã¯æ®‹ã‚Š2ã¤ï¼
ã‚ã¨å°‘ã—ã ã‹ã‚‰ã€é ‘å¼µã£ã¦ğŸ˜†âœ¨ï¸
æ¬¡ã«æ•™ãˆã¦æ¬²ã—ã„ã®ã¯ã€ã“ã‚Œã¾ã§ã‚„ã£ã¦ããŸã“ã¨ã€
ã“ã“ã¯æ¬¡å›æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã—ã£ã‹ã‚Šãƒ’ã‚¢ãƒªãƒ³ã‚°ã—ã¦ã„ãã‹ã‚‰ã€ã–ã£ãã‚Šã§OKã ã‚ˆã€‚
ã“ã‚Œã¾ã§ã‚„ã£ã¦ããŸã“ã¨ã§ã€ã“ã‚Œã‹ã‚‰ã‚‚æ´»ã‹ã—ãŸã„ã“ã¨ã‚’æ•™ãˆã¦ã­ã€‚;                 } else if (awaitingSelection) {                     const selectedOption = selectionOptions.find(opt => message.includes(opt));                     if (selectedOption) {                         sessionData.wantConditions.push(selectedOption);                         awaitingSelection = false;                         selectionOptions = [];                         response = äº†è§£ï¼${selectedOption}ã ã¨å¬‰ã—ã„ã£ã¦ã“ã¨ã ã­ï¼
ä»–ã«ã‚‚ã‚ã£ãŸã‚‰ã„ã„ãªã£ã¦ã„ã†ã®ã¯ã‚ã‚‹ï¼Ÿ`;
} else {
response = "é¸æŠè‚¢ã®ä¸­ã‹ã‚‰é¸ã‚“ã§ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ";
}
} else {
// mustwantè¾æ›¸ãƒãƒƒãƒãƒ³ã‚°
const allItems = flattenMustWantDict();
const matchedItems = allItems.filter(item => {
return message.toLowerCase().includes(item.toLowerCase()) ||
item.toLowerCase().includes(message.toLowerCase().split(' ')[0]);
});
                if (matchedItems.length === 0) {
                    response = `äº†è§£ï¼æ°—æŒã¡ã¯å—ã‘å–ã£ãŸã‚ˆâ—
ä»–ã«ã‚‚ã‚ã£ãŸã‚‰ã„ã„ãªã£ã¦ã„ã†ã®ã¯ã‚ã‚‹ï¼Ÿ;                     } else {                         const topMatches = matchedItems.slice(0, 3);                         if (topMatches.length === 1) {                             sessionData.wantConditions.push(topMatches[0]);                             response = äº†è§£ï¼${topMatches[0]}ã ã¨å¬‰ã—ã„ã£ã¦ã“ã¨ã ã­ï¼
ä»–ã«ã‚‚ã‚ã£ãŸã‚‰ã„ã„ãªã£ã¦ã„ã†ã®ã¯ã‚ã‚‹ï¼Ÿ;                         } else {                             const optionsList = topMatches.map(opt => ã€${opt}ã€).join('ï¼');                             awaitingSelection = true;                             selectionOptions = topMatches;                             response = ã“ã®ä¸­ã ã¨ã©ã‚ŒãŒä¸€ç•ªè¿‘ã„ï¼Ÿ${optionsList};                         }                     }                 }             }             // Step4: Canï¼ˆã“ã‚Œã¾ã§ã‚„ã£ã¦ããŸã“ã¨ï¼‰             else if (currentStep === 4) {                 sessionData.canDo = message;                 currentStep = 5;                 shouldUpdateStep = true;                 response = ã„ã„ã­ï¼
ã“ã‚ŒãŒæœ€å¾Œã®è³ªå•ğŸ‘
ä»Šå›ã®è»¢è·ã§å¶ãˆãŸã„æŒ‘æˆ¦ã‚„ã€å¤¢ã¯ã‚ã‚‹ï¼Ÿ;             }             // Step5: Willï¼ˆæŒ‘æˆ¦ã—ãŸã„ã“ã¨ï¼‰             else if (currentStep === 5) {                 sessionData.willDo = message;                 currentStep = 6;                 shouldUpdateStep = true;                 response = ä»Šæ—¥ã¯ãŸãã•ã‚“è©±ã—ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ï¼
ã“ã“ã¾ã§ã®å†…å®¹ã‚’æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å¼•ãç¶™ãã­ã€‚
æ¬¡å›ã®é¢è«‡ã§ä¸€ç·’ã«è©°ã‚ã¦ã„ã“ã†ï¼
ğŸ“‹ åé›†ãƒ‡ãƒ¼ã‚¿
æ±‚è·è€…ç•ªå·: ${sessionData.candidateNumber}
è»¢è·ç†ç”±: ${sessionData.transferReason || 'æœªè¨­å®š'}
çµ¶å¯¾æ¡ä»¶: ${sessionData.mustConditions.length > 0 ? sessionData.mustConditions.join(', ') : 'æœªè¨­å®š'}
å¸Œæœ›æ¡ä»¶: ${sessionData.wantConditions.length > 0 ? sessionData.wantConditions.join(', ') : 'æœªè¨­å®š'}
æ´»ã‹ã—ãŸã„çµŒé¨“: ${sessionData.canDo}
æŒ‘æˆ¦ã—ãŸã„ã“ã¨: ${sessionData.willDo}`;
}
        hideTyping();
        addMessage('ai', response);
        
        if (shouldUpdateStep) {
            updateProgressBar();
            updatePlaceholder();
        }
    }

    function updatePlaceholder() {
        const input = document.getElementById('message-input');
        if (currentStep === 0 && !isNumberConfirmed) {
            input.placeholder = "æ±‚è·è€…ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...";
        } else {
            input.placeholder = "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...";
        }
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.getElementById('send-button').addEventListener('click', async () => {
        const input = document.getElementById('message-input');
        const message = input.value.trim();
        
        if (!message) return;
        
        addMessage('user', message);
        input.value = '';
        
        await processMessage(message);
    });

    document.getElementById('message-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            document.getElementById('send-button').click();
        }
    });

    // åˆæœŸåŒ–
    updateProgressBar();
    updatePlaceholder();
</script>
</body>
</html>
```
